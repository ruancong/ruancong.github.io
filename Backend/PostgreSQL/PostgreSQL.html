<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.19" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <link rel="icon" href="/images/logo.svg"><title>Notes</title><meta name="description" content="Daily Learning Notes">
    <link rel="preload" href="/assets/style-CFLOtTbv.css" as="style"><link rel="stylesheet" href="/assets/style-CFLOtTbv.css">
    <link rel="modulepreload" href="/assets/app-o1JNg1TA.js"><link rel="modulepreload" href="/assets/PostgreSQL.html-DDYEyQ9j.js">
    <link rel="prefetch" href="/assets/index.html-ni2GAa8i.js" as="script"><link rel="prefetch" href="/assets/commands.html-CB5ctJWK.js" as="script"><link rel="prefetch" href="/assets/linux.html-Bx8119pF.js" as="script"><link rel="prefetch" href="/assets/MinIO.html-QW2q_SWc.js" as="script"><link rel="prefetch" href="/assets/docker.html-B1E5C4pQ.js" as="script"><link rel="prefetch" href="/assets/forget-lock-psw.html-CytWY1ix.js" as="script"><link rel="prefetch" href="/assets/raft.html-Bmw1Snnb.js" as="script"><link rel="prefetch" href="/assets/split-brain.html-CTi4TaPU.js" as="script"><link rel="prefetch" href="/assets/gemini_manual.html-DNqhV9MT.js" as="script"><link rel="prefetch" href="/assets/k8s.html-DcCschSi.js" as="script"><link rel="prefetch" href="/assets/network-basis.html-CPXyzNUF.js" as="script"><link rel="prefetch" href="/assets/问题解决.html-CksNFd3C.js" as="script"><link rel="prefetch" href="/assets/English-Grammar.html-D-YdK5hZ.js" as="script"><link rel="prefetch" href="/assets/英语句子解析.html-K9Vtk3QZ.js" as="script"><link rel="prefetch" href="/assets/语法学习.html-Da30neLH.js" as="script"><link rel="prefetch" href="/assets/template.html-CXfVXLzX.js" as="script"><link rel="prefetch" href="/assets/nextjs.html-Bf4rCWvI.js" as="script"><link rel="prefetch" href="/assets/react-router.html-PW_tUaN4.js" as="script"><link rel="prefetch" href="/assets/react.html-CrO6zNdo.js" as="script"><link rel="prefetch" href="/assets/spingboot-3.x.html-DgU1iuyb.js" as="script"><link rel="prefetch" href="/assets/05-20.html-D0uMoOzj.js" as="script"><link rel="prefetch" href="/assets/05-21.html-qmX2h3ac.js" as="script"><link rel="prefetch" href="/assets/05-22.html-iC1Zcgy9.js" as="script"><link rel="prefetch" href="/assets/05-23.html-CC9dyQHM.js" as="script"><link rel="prefetch" href="/assets/02-26.html-D4e-LV8r.js" as="script"><link rel="prefetch" href="/assets/01-03.html-C3j2imdk.js" as="script"><link rel="prefetch" href="/assets/01-08.html-P1RkeWTO.js" as="script"><link rel="prefetch" href="/assets/01-10.html-B0h-Sw3T.js" as="script"><link rel="prefetch" href="/assets/01-15.html-DbI4Tn3U.js" as="script"><link rel="prefetch" href="/assets/07-09.html-DwbJRq1n.js" as="script"><link rel="prefetch" href="/assets/07-10.html-DP8BfFvJ.js" as="script"><link rel="prefetch" href="/assets/07-11.html-DzdZMc1R.js" as="script"><link rel="prefetch" href="/assets/07-12.html-CmsAiH1K.js" as="script"><link rel="prefetch" href="/assets/07-13.html-COK0jfjy.js" as="script"><link rel="prefetch" href="/assets/07-14.html-BFzJxKrX.js" as="script"><link rel="prefetch" href="/assets/07-15.html-iNcOW7Qr.js" as="script"><link rel="prefetch" href="/assets/07-16.html-DuBVg1PP.js" as="script"><link rel="prefetch" href="/assets/09-03.html-jWUR6C9e.js" as="script"><link rel="prefetch" href="/assets/404.html-412e80DU.js" as="script"><link rel="prefetch" href="/assets/VocabularyAudio-DL21C7vh.js" as="script"><link rel="prefetch" href="/assets/setupDevtools-7MC2TMWH-DP_ZCpCU.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><img class="vp-site-logo" src="/images/logo.svg" alt="Notes"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">Notes</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="首页"><!---->首页<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/ruancong/ruancong.github.io" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="首页"><!---->首页<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/ruancong/ruancong.github.io" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading"> <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div><h2 id="sql注释" tabindex="-1"><a class="header-anchor" href="#sql注释"><span>sql注释</span></a></h2><p>Two dashes (“--”) introduce comments. Whatever follows them is ignored up to the end of the line.</p><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">CREATE TABLE weather (</span>
<span class="line">city varchar(80),</span>
<span class="line">temp_lo int, -- low temperature</span>
<span class="line">temp_hi int, -- high temperature</span>
<span class="line">prcp real, -- precipitation</span>
<span class="line">date date</span>
<span class="line">);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="大小写不敏感" tabindex="-1"><a class="header-anchor" href="#大小写不敏感"><span>大小写不敏感</span></a></h2><p>SQL is case-insensitive about key words and identifiers, except when identifiers are double-quoted to preserve the case.</p><p>在不使用双引号时，关键字与表名、列名等标识符是大小写不敏感的</p><h2 id="数据类型" tabindex="-1"><a class="header-anchor" href="#数据类型"><span>数据类型</span></a></h2><p>PostgreSQL supports the standard SQL types int, smallint, real, double precision, char(N), varchar(N), date, time, timestamp, and interval, as well as other types of general utility and a rich set of geometric types.</p><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">CREATE TABLE cities (</span>
<span class="line">name varchar(80),</span>
<span class="line">location point</span>
<span class="line">);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>The point type is an example of a PostgreSQL-specific data type.</p></blockquote><h2 id="聚合函数中的filter" tabindex="-1"><a class="header-anchor" href="#聚合函数中的filter"><span>聚合函数中的FILTER</span></a></h2><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">SELECT city, count(*) FILTER (WHERE temp_lo &lt; 45), max(temp_lo)</span>
<span class="line">FROM weather</span>
<span class="line">GROUP BY city;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Here, the count aggregate counts only rows with temp_lo below 45; but the max aggregate is still applied to all rows. 即这个temp_lo &lt; 45的条件只有在计算count(*) 生效，在计算max(temp_lo)时还是取所有的纪录</p></blockquote><h2 id="视图" tabindex="-1"><a class="header-anchor" href="#视图"><span>视图</span></a></h2><p>创建视图</p><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">CREATE VIEW myview AS</span>
<span class="line">SELECT name, temp_lo, temp_hi, prcp, date, location</span>
<span class="line">FROM weather, cities</span>
<span class="line">WHERE city = name;</span>
<span class="line">SELECT * FROM myview;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="window-function-窗口函数" tabindex="-1"><a class="header-anchor" href="#window-function-窗口函数"><span>window function(窗口函数)</span></a></h2><p>A window function call always contains an OVER clause directly following the window function&#39;s name and argument(s).</p><p>例如下面这个sql：</p><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">SELECT depname, empno, salary, avg(salary) OVER (PARTITION BY</span>
<span class="line">depname) FROM empsalary;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>其中avg()就是一个窗口函数【带有OVER关键词】。</p><p>查询结果类似这样：</p><table><thead><tr><th>depname</th><th>empno</th><th>salary</th><th>avg</th></tr></thead><tbody><tr><td>develop</td><td>11</td><td>5200</td><td>5020.0000000000000000</td></tr><tr><td>develop</td><td>7</td><td>4200</td><td>5020.0000000000000000</td></tr><tr><td>develop</td><td>9</td><td>4500</td><td>5020.0000000000000000</td></tr><tr><td>develop</td><td>8</td><td>6000</td><td>5020.0000000000000000</td></tr><tr><td>develop</td><td>10</td><td>5200</td><td>5020.0000000000000000</td></tr><tr><td>personnel</td><td>5</td><td>3500</td><td>3700.0000000000000000</td></tr><tr><td>personnel</td><td>2</td><td>3900</td><td>3700.0000000000000000</td></tr><tr><td>sales</td><td>3</td><td>4800</td><td>4866.6666666666666667</td></tr><tr><td>sales</td><td>1</td><td>5000</td><td>4866.6666666666666667</td></tr><tr><td>sales</td><td>4</td><td>4800</td><td>4866.6666666666666667</td></tr></tbody></table><p>The PARTITION BY clause within OVER divides the rows into groups, or partitions, that share the same values of the PARTITION BY expression(s).</p><hr><p>There is another important concept associated with window functions: for each row, there is a set of rows within its partition called its window frame. Some window functions act only on the rows of the window frame, rather than of the whole partition. By default, if ORDER BY is supplied then the frame consists of all rows from the start of the partition up through the current row, plus any following rows that are equal to the current row according to the ORDER BY clause. When ORDER BY is omitted the default frame consists of all rows in the partition. 【如果order by 没有省略，那么这行的window frame的范围为从当前的partition的开始位置到当前行，再加上与当前行的order by的字段的值相等的所有行。如果order by 省略了，就是partition中的所有行】</p><p>省略order by 的例子：</p><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">SELECT salary, sum(salary) OVER () FROM empsalary;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>查询结果 ：</p><table><thead><tr><th>salary</th><th>sum</th></tr></thead><tbody><tr><td>5200</td><td>47100</td></tr><tr><td>5000</td><td>47100</td></tr><tr><td>3500</td><td>47100</td></tr><tr><td>4800</td><td>47100</td></tr><tr><td>3900</td><td>47100</td></tr><tr><td>4200</td><td>47100</td></tr><tr><td>4500</td><td>47100</td></tr><tr><td>4800</td><td>47100</td></tr><tr><td>6000</td><td>47100</td></tr><tr><td>5200</td><td>47100</td></tr></tbody></table><p>因为省略了order by 所有sum(salary)就是所有行相加的结果 。</p><p>有order by 的例子：</p><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">SELECT salary, sum(salary) OVER (ORDER BY salary) FROM empsalary;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>查询结果：</p><table><thead><tr><th>salary</th><th>sum</th></tr></thead><tbody><tr><td>3500</td><td>3500</td></tr><tr><td>3900</td><td>7400</td></tr><tr><td>4200</td><td>11600</td></tr><tr><td>4500</td><td>16100</td></tr><tr><td>4800</td><td>25700</td></tr><tr><td>4800</td><td>25700</td></tr><tr><td>5000</td><td>30700</td></tr><tr><td>5200</td><td>41100</td></tr><tr><td>5200</td><td>41100</td></tr><tr><td>6000</td><td>47100</td></tr></tbody></table><blockquote><p>注意看4800两条纪录的的sum的值</p></blockquote><p>Window functions are permitted only in the SELECT list and the ORDER BY clause of the query.</p><hr><p>窗口函数还可以用于子查询:</p><ol><li>查出每个部门排名前两位的纪录【有相同时工资时，每个部门可以大于两条纪录】</li></ol><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">select depname, empno, salary, pos</span>
<span class="line">from (select depname,</span>
<span class="line">             empno,</span>
<span class="line">             salary, rank() over ( partition by depname order by salary desc) as pos</span>
<span class="line">      from empsalary) as temp</span>
<span class="line">where pos &lt; 3;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>查出每个部门排名前两位的纪录【有相同时工资时，取工号排名靠前的两条】</li></ol><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">SELECT depname, empno, salary, pos</span>
<span class="line">FROM (SELECT depname,</span>
<span class="line">             empno,</span>
<span class="line">             salary,</span>
<span class="line">             rank() OVER (PARTITION BY depname ORDER BY salary DESC,</span>
<span class="line">                 empno) AS pos</span>
<span class="line">      FROM empsalary) AS ss</span>
<span class="line">WHERE pos &lt; 3;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><p>当一个查询中涉及多个窗口函数时，可以用WINDDOW子句来定义窗口行为，再在OVER中引用</p><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">SELECT sum(salary) OVER w, avg(salary) OVER w</span>
<span class="line">FROM empsalary</span>
<span class="line">WINDOW w AS (PARTITION BY depname ORDER BY salary DESC);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="inheritance-表继承" tabindex="-1"><a class="header-anchor" href="#inheritance-表继承"><span>Inheritance(表继承)</span></a></h2><p>像面向对象编程一样的，在postgreSQL中也支持表的继承。如下：</p><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">CREATE TABLE cities (</span>
<span class="line">name text,</span>
<span class="line">population real,</span>
<span class="line">elevation int -- (in ft)</span>
<span class="line">);</span>
<span class="line">CREATE TABLE capitals (</span>
<span class="line">state char(2) UNIQUE NOT NULL</span>
<span class="line">) INHERITS (cities);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在往cities表中插入数据时，数据会存储在cities中的物理表中，数据不会在capitals中显示；往capitals中插入数据时，数据会存储在capitals的物理表中，但数据也会同步在cities中显示。</p><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">SELECT name, elevation</span>
<span class="line">FROM cities;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>上面这个查询语句会查询出两个表中的所有数据。</p><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">SELECT name, elevation</span>
<span class="line">FROM ONLY cities;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>上面这个查询语句会只查询出 cities这个表中的数据。同样地，<code>only</code>关键词支持<code>SELECT, UPDATE, and DELETE</code>语句。</p><h2 id="identifier-标识符" tabindex="-1"><a class="header-anchor" href="#identifier-标识符"><span>Identifier(标识符)</span></a></h2><p>SQL identifiers and key words must begin with a letter (a-z, but also letters with diacritical marks and non-Latin letters) or an underscore (_).</p><p>标识符可以以任何一个字符开头，这个字符可以是a-z(不区分大小写)；可以是带变音符号的字母，可以中日文等； 可以是下划线。不能以数字开头。标识符后面的字符可以是字母、数字、下划线和<code>$</code>符号【SQL标准中并不支持，所以会给移植带来不便】 。SQL标准不会定义包含任何数字或者以下划线开头或者以下划线结束的关键词。</p><p>系统使用的标识符的字节长度不超过<code> NAMEDATALEN-1</code>个，其中的<code> NAMEDATALEN</code>默认大小为64。声明在<code>src/include/pg_config_manual.h</code>当中【修改此常量需要重新编译 PostgreSQL 源代码才能生效】</p><p>Key words and unquoted identifiers are case-insensitive. A convention often used is to write key words in upper case and names in lower case, e.g.: <code>UPDATE my_table SET a = 5;</code></p><p>还有一种是带有双引号的标识符，双引号里面可以是任何字符【非0】；这使得大小写敏感了。还可以<code>U&amp;</code>开头来使用unicode码来定义标识符，如<code>U&amp;&quot;d\0061t\+000061&quot;</code></p><h2 id="常量" tabindex="-1"><a class="header-anchor" href="#常量"><span>常量</span></a></h2><ol><li>常规字符串</li></ol><p>字符串中有单引号时，用两个相邻的单引号来表示，如：</p><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">select &#39;my name&#39;&#39;s is LeiTe&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>两个换行【至少一个换行符】的字符串会被合成一个串。如：</p><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">SELECT &#39;foo&#39;</span>
<span class="line">&#39;bar&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>上面这个语句与下面这个是等效的</p><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">SELECT &#39;foobar&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><ol start="2"><li>转义符字符串：</li></ol><p>An escape string constant is specified by writing the letter E (upper or lower case) just before the opening single quote, e.g., <code>E&#39;foo\nbar&#39;</code>.</p><p>当<code>standard_conforming_strings</code>这个配置是off时，在普通的字符串中的<code>\</code>和<code>E&#39;&#39;</code>字符串中<code>\</code>都有转义的功能。在<code>Post-greSQL 9.1</code>版本后这个设置默认值是on。只有在<code>E&#39;&#39;</code>字符串中<code>\</code>才有转义的功能，即</p><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">SELECT &#39;foo&#39;</span>
<span class="line"> &#39;\nbar&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>这个sql中的<code>\n</code>没有换行功能</p><hr><ol start="3"><li>Unicode转义字符串：</li></ol><p>用<code>u&amp;</code>前缀表示为unicode转义的字符串。<code>\</code>加4位16进制数字或者<code>\+</code>加6位16进制数</p><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">select * from cities where name = &#39;Hello from PostgreSQL! 👋😊🎉&#39;;</span>
<span class="line"></span>
<span class="line">SELECT * FROM cities</span>
<span class="line">WHERE name = U&amp;&#39;Hello from PostgreSQL! \+01F44B\+01F60A\+01F389&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面这两个效果是相同的。</p><hr><ol start="4"><li>Dollar-Quoted String Constants：</li></ol><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">select $$Dianne&#39;s horse$$;</span>
<span class="line"></span>
<span class="line">select  $SomeTag$Dianne&#39;s horse$SomeTag$;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面两个sql效果相同，将会得到<code>Dianne&#39;s horse</code>。$$里面的字符串都不会转义</p><hr><ol start="5"><li>Bit-String Constants：</li></ol><p><code>B&#39;1001&#39;</code>这种是只有0和1；</p><p><code> X&#39;1FF&#39;</code>16进制数字</p><ol start="6"><li>其它类型的常量转化</li></ol><p><code>type &#39;string&#39;</code>： 标准SQL只支持部分类型转换，postgreSQL支持所有类型 <code>&#39;string&#39;::type</code>：postgreSQL历史使用原因，相当于<code>typename ( &#39;string&#39; )</code> 函数调用 <code>CAST ( &#39;string&#39; AS type )</code>: 符合标准SQL</p><h2 id="聚合函数表达式" tabindex="-1"><a class="header-anchor" href="#聚合函数表达式"><span>聚合函数表达式</span></a></h2><p>count(*) yields the total number of input rows; count(f1) yields the number of input rows in which f1 is non-null, since count ignores nulls; and count(distinct f1) yields the number of distinct non-null values of f1.</p><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">-- 所有行数</span>
<span class="line">select count(*) from public.cities;</span>
<span class="line">-- name列中非null的数量</span>
<span class="line">select count(name) from public.cities;</span>
<span class="line">-- name列中非null非重复的数量</span>
<span class="line">select count(distinct name) from public.cities;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="table" tabindex="-1"><a class="header-anchor" href="#table"><span>Table</span></a></h2><p>There is a limit on how many columns a table can contain. Depending on the column types, it is between 250 and 1600.</p><p>提供默认值：</p><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">CREATE TABLE products (</span>
<span class="line">product_no integer DEFAULT nextval(&#39;products_product_no_seq&#39;),</span>
<span class="line">...</span>
<span class="line">);</span>
<span class="line">-- 这种方式还有一种简短方式</span>
<span class="line">CREATE TABLE products (</span>
<span class="line">product_no SERIAL,</span>
<span class="line">...</span>
<span class="line">);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>DEFAULTS可以用于insert与update语句中</p><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">INSERT INTO people (id, name, address) VALUES (DEFAULT, &#39;C&#39;,&#39;baz&#39;);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="identity-column" tabindex="-1"><a class="header-anchor" href="#identity-column"><span>identity column</span></a></h3><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">CREATE TABLE people (</span>
<span class="line">id bigint GENERATED ALWAYS AS IDENTITY,</span>
<span class="line">...,</span>
<span class="line">);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>以下是 GENERATED ALWAYS AS IDENTITY 和 SERIAL 的详细对比：</p><table><thead><tr><th>特性</th><th>GENERATED ALWAYS AS IDENTITY</th><th>SERIAL</th></tr></thead><tbody><tr><td><strong>定义</strong></td><td>基于 SQL 标准的自增列，显式绑定到序列。</td><td>PostgreSQL 特有的伪类型，简化为序列绑定。</td></tr><tr><td><strong>SQL 标准</strong></td><td>符合 SQL 标准，可移植性更好。</td><td>非 SQL 标准，仅 PostgreSQL 支持。</td></tr><tr><td><strong>类型支持</strong></td><td>可搭配 smallint、integer、bigint。</td><td>SMALLSERIAL、SERIAL、BIGSERIAL 分别对应三种类型。</td></tr><tr><td><strong>手动插入值</strong></td><td>默认禁止（需 OVERRIDING SYSTEM VALUE）。</td><td>允许手动插入值，序列不受影响。</td></tr><tr><td><strong>严格性</strong></td><td>更严格，适合需要明确自增行为的场景。</td><td>更宽松，适合快速开发。</td></tr><tr><td><strong>序列控制</strong></td><td>可在建表时直接指定序列选项（START WITH 等）。</td><td>需要手动修改底层序列（ALTER SEQUENCE）。</td></tr><tr><td><strong>现代化</strong></td><td>PostgreSQL 10+ 推荐的方式，未来更优支持。</td><td>传统方式，兼容性强但较老旧。</td></tr><tr><td><strong>底层实现</strong></td><td>依赖序列，绑定更显式，列标记为 IDENTITY。</td><td>依赖序列，绑定通过 DEFAULT nextval() 实现。</td></tr><tr><td><strong>迁移性</strong></td><td>更适合跨数据库迁移（例如 Oracle、SQL Server）。</td><td>需转换为其他数据库的自增机制（如 MySQL 的 AUTO_INCREMENT）。</td></tr></tbody></table></blockquote><blockquote><p>手动插入值</p><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">insert into products_with_id (product_no, name, price) OVERRIDING SYSTEM VALUE</span>
<span class="line">values (200, &#39;test&#39;, default);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="generated-by-default-vs-generated-always" tabindex="-1"><a class="header-anchor" href="#generated-by-default-vs-generated-always"><span><code>GENERATED BY DEFAULT</code> vs <code>GENERATED ALWAYS</code></span></a></h3><ul><li><code>GENERATED BY DEFAULT</code>：默认生成，但你可以直接插入值，无需 <code>OVERRIDING</code></li><li><code>GENERATED ALWAYS</code>：总是由系统生成，想覆盖就必须用 <code>OVERRIDING SYSTEM VALUE</code></li></ul></blockquote><p>identity column不保证唯一性。</p><p>An identity column is automatically marked as NOT NULL. An identity column, however, does not guarantee uniqueness. (A sequence normally returns unique values, but a sequence could be reset, or values could be inserted manually into the identity column, as discussed above.) Uniqueness would need to be enforced using a PRIMARY KEY or UNIQUE constraint.</p><p>标识列不会在继承中体现：</p><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">-- 清理环境 (如果已存在)</span>
<span class="line">DROP TABLE IF EXISTS child1 CASCADE;</span>
<span class="line">DROP TABLE IF EXISTS parent1 CASCADE;</span>
<span class="line"></span>
<span class="line">-- 1. 创建父表 parent1，包含一个标识列 id</span>
<span class="line">CREATE TABLE parent1 (</span>
<span class="line">    id INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,</span>
<span class="line">    description TEXT</span>
<span class="line">);</span>
<span class="line"></span>
<span class="line">-- 2. 创建子表 child1，继承自 parent1</span>
<span class="line">-- child1 没有为 id 列重新定义标识列属性</span>
<span class="line">CREATE TABLE child1 (</span>
<span class="line">    child_specific_attribute TEXT</span>
<span class="line">) INHERITS (parent1);</span>
<span class="line">-- 这时child1中继承的id列不是标识列，但是id的not null 约束会被继承，所以INSERT INTO child1 (description, child_specific_attribute)</span>
<span class="line">-- VALUES (&#39;Data for child1, id from parent1 sequence&#39;, &#39;Child specific value&#39;); 会报错</span>
<span class="line"></span>
<span class="line">--   只有这样创建子表 child1，并为 id 列显式声明 IDENTITY 属性子表中的id列才为标识列</span>
<span class="line">CREATE TABLE child1 (</span>
<span class="line">    id INT GENERATED ALWAYS AS IDENTITY (START WITH 100 INCREMENT BY 1), -- 子表序列从100开始</span>
<span class="line">    child_specific_attribute TEXT</span>
<span class="line">) INHERITS (parent1);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="generated-columns" tabindex="-1"><a class="header-anchor" href="#generated-columns"><span>Generated Columns</span></a></h3><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">CREATE TABLE people (</span>
<span class="line">...,</span>
<span class="line">height_cm numeric,</span>
<span class="line">height_in numeric GENERATED ALWAYS AS (height_cm / 2.54) STORED</span>
<span class="line">);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>PostgreSQL currently implements only stored generated columns.</p></blockquote><h3 id="check-constraint" tabindex="-1"><a class="header-anchor" href="#check-constraint"><span>Check Constraint</span></a></h3><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">CREATE TABLE products (</span>
<span class="line">product_no integer,</span>
<span class="line">name text,</span>
<span class="line">price numeric CHECK (price &gt; 0)</span>
<span class="line">);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">-- 可以为constraint单独命名一个名字</span>
<span class="line">CREATE TABLE products (</span>
<span class="line">product_no integer,</span>
<span class="line">name text,</span>
<span class="line">price numeric CONSTRAINT positive_price CHECK (price &gt; 0)</span>
<span class="line">);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>CHECK 可以引用引用其它列</p><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">CREATE TABLE products (</span>
<span class="line">product_no integer,</span>
<span class="line">name text,</span>
<span class="line">price numeric CHECK (price &gt; 0),</span>
<span class="line">discounted_price numeric CHECK (discounted_price &gt; 0),</span>
<span class="line">CHECK (price &gt; discounted_price)</span>
<span class="line">);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1308811723@qq.com">RuanCong</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-o1JNg1TA.js" defer></script>
  </body>
</html>
