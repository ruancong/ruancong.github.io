<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.19" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <link rel="icon" href="/images/logo.svg"><title>Notes</title><meta name="description" content="Daily Learning Notes">
    <link rel="preload" href="/assets/style-BdpwS4KR.css" as="style"><link rel="stylesheet" href="/assets/style-BdpwS4KR.css">
    <link rel="modulepreload" href="/assets/app-BqkxZZE-.js"><link rel="modulepreload" href="/assets/PostgreSQL.html-CupybYb1.js">
    <link rel="prefetch" href="/assets/index.html-C-3MOntD.js" as="script"><link rel="prefetch" href="/assets/linux.html-DAoS9Az4.js" as="script"><link rel="prefetch" href="/assets/MinIO.html-1DNk1SOs.js" as="script"><link rel="prefetch" href="/assets/docker.html-CHw-A2yE.js" as="script"><link rel="prefetch" href="/assets/forget-lock-psw.html-BMIX7dcy.js" as="script"><link rel="prefetch" href="/assets/raft.html-DR8eLWZz.js" as="script"><link rel="prefetch" href="/assets/split-brain.html-Dj9JKQ8k.js" as="script"><link rel="prefetch" href="/assets/network-basis.html-Bb0ex3Bm.js" as="script"><link rel="prefetch" href="/assets/问题解决.html-CfYMZscC.js" as="script"><link rel="prefetch" href="/assets/English-Grammar.html-DCWmIuvu.js" as="script"><link rel="prefetch" href="/assets/英语句子解析.html-COYWCbhT.js" as="script"><link rel="prefetch" href="/assets/template.html-Cy101xf3.js" as="script"><link rel="prefetch" href="/assets/react-router.html-BtEGx7b8.js" as="script"><link rel="prefetch" href="/assets/react.html-C8SxSlmd.js" as="script"><link rel="prefetch" href="/assets/spingboot-3.x.html-Dl65lMbL.js" as="script"><link rel="prefetch" href="/assets/05-20.html-DVGkG4O1.js" as="script"><link rel="prefetch" href="/assets/05-21.html-BWcmcv2V.js" as="script"><link rel="prefetch" href="/assets/05-22.html-BOsEgvnc.js" as="script"><link rel="prefetch" href="/assets/05-23.html-DwOYoi6g.js" as="script"><link rel="prefetch" href="/assets/02-26.html-pCHznFLJ.js" as="script"><link rel="prefetch" href="/assets/01-03.html-C4DtXwoa.js" as="script"><link rel="prefetch" href="/assets/01-08.html-8cnotXH3.js" as="script"><link rel="prefetch" href="/assets/01-10.html-B9V3ZIoB.js" as="script"><link rel="prefetch" href="/assets/01-15.html-TxRedlrz.js" as="script"><link rel="prefetch" href="/assets/404.html-4IHnQtlS.js" as="script"><link rel="prefetch" href="/assets/VocabularyAudio-C8UxUrbV.js" as="script"><link rel="prefetch" href="/assets/setupDevtools-7MC2TMWH-BshMt9Qx.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><img class="vp-site-logo" src="/images/logo.svg" alt="Notes"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">Notes</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="首页"><!---->首页<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/ruancong/ruancong.github.io" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="首页"><!---->首页<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/ruancong/ruancong.github.io" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading"> <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div><h2 id="sql注释" tabindex="-1"><a class="header-anchor" href="#sql注释"><span>sql注释</span></a></h2><p>Two dashes (“--”) introduce comments. Whatever follows them is ignored up to the end of the line.</p><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">CREATE TABLE weather (</span>
<span class="line">city varchar(80),</span>
<span class="line">temp_lo int, -- low temperature</span>
<span class="line">temp_hi int, -- high temperature</span>
<span class="line">prcp real, -- precipitation</span>
<span class="line">date date</span>
<span class="line">);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="大小写不敏感" tabindex="-1"><a class="header-anchor" href="#大小写不敏感"><span>大小写不敏感</span></a></h2><p>SQL is case-insensitive about key words and identifiers, except when identifiers are double-quoted to preserve the case.</p><p>在不使用双引号时，关键字与表名、列名等标识符是大小写不敏感的</p><h2 id="数据类型" tabindex="-1"><a class="header-anchor" href="#数据类型"><span>数据类型</span></a></h2><p>PostgreSQL supports the standard SQL types int, smallint, real, double precision, char(N), varchar(N), date, time, timestamp, and interval, as well as other types of general utility and a rich set of geometric types.</p><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">CREATE TABLE cities (</span>
<span class="line">name varchar(80),</span>
<span class="line">location point</span>
<span class="line">);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>The point type is an example of a PostgreSQL-specific data type.</p></blockquote><h2 id="聚合函数中的filter" tabindex="-1"><a class="header-anchor" href="#聚合函数中的filter"><span>聚合函数中的FILTER</span></a></h2><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">SELECT city, count(*) FILTER (WHERE temp_lo &lt; 45), max(temp_lo)</span>
<span class="line">FROM weather</span>
<span class="line">GROUP BY city;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Here, the count aggregate counts only rows with temp_lo below 45; but the max aggregate is still applied to all rows. 即这个temp_lo &lt; 45的条件只有在计算count(*) 生效，在计算max(temp_lo)时还是取所有的纪录</p></blockquote><h2 id="视图" tabindex="-1"><a class="header-anchor" href="#视图"><span>视图</span></a></h2><p>创建视图</p><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">CREATE VIEW myview AS</span>
<span class="line">SELECT name, temp_lo, temp_hi, prcp, date, location</span>
<span class="line">FROM weather, cities</span>
<span class="line">WHERE city = name;</span>
<span class="line">SELECT * FROM myview;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="window-function" tabindex="-1"><a class="header-anchor" href="#window-function"><span>window function</span></a></h2><p>A window function call always contains an OVER clause directly following the window function&#39;s name and argument(s).</p><p>例如下面这个sql：</p><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">SELECT depname, empno, salary, avg(salary) OVER (PARTITION BY</span>
<span class="line">depname) FROM empsalary;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>其中avg()就是一个窗口函数【带有OVER关键词】。</p><p>查询结果类似这样：</p><table><thead><tr><th>depname</th><th>empno</th><th>salary</th><th>avg</th></tr></thead><tbody><tr><td>develop</td><td>11</td><td>5200</td><td>5020.0000000000000000</td></tr><tr><td>develop</td><td>7</td><td>4200</td><td>5020.0000000000000000</td></tr><tr><td>develop</td><td>9</td><td>4500</td><td>5020.0000000000000000</td></tr><tr><td>develop</td><td>8</td><td>6000</td><td>5020.0000000000000000</td></tr><tr><td>develop</td><td>10</td><td>5200</td><td>5020.0000000000000000</td></tr><tr><td>personnel</td><td>5</td><td>3500</td><td>3700.0000000000000000</td></tr><tr><td>personnel</td><td>2</td><td>3900</td><td>3700.0000000000000000</td></tr><tr><td>sales</td><td>3</td><td>4800</td><td>4866.6666666666666667</td></tr><tr><td>sales</td><td>1</td><td>5000</td><td>4866.6666666666666667</td></tr><tr><td>sales</td><td>4</td><td>4800</td><td>4866.6666666666666667</td></tr></tbody></table><p>The PARTITION BY clause within OVER divides the rows into groups, or partitions, that share the same values of the PARTITION BY expression(s).</p><p>There is another important concept associated with window functions: for each row, there is a set of rows within its partition called its window frame. Some window functions act only on the rows of the window frame, rather than of the whole partition. By default, if ORDER BY is supplied then the frame consists of all rows from the start of the partition up through the current row, plus any following rows that are equal to the current row according to the ORDER BY clause. When ORDER BY is omitted the default frame consists of all rows in the partition. 【如果order by 没有省略，那么这行的window frame的范围为从当前的partition的开始位置到当前行，再加上与当前行的order by的字段的值相等的所有行。如果order by 省略了，就是partition中的所有行】</p><p>省略order by 的例子：</p><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">SELECT salary, sum(salary) OVER () FROM empsalary;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>查询结果 ：</p><table><thead><tr><th>salary</th><th>sum</th></tr></thead><tbody><tr><td>5200</td><td>47100</td></tr><tr><td>5000</td><td>47100</td></tr><tr><td>3500</td><td>47100</td></tr><tr><td>4800</td><td>47100</td></tr><tr><td>3900</td><td>47100</td></tr><tr><td>4200</td><td>47100</td></tr><tr><td>4500</td><td>47100</td></tr><tr><td>4800</td><td>47100</td></tr><tr><td>6000</td><td>47100</td></tr><tr><td>5200</td><td>47100</td></tr></tbody></table><p>因为省略了order by 所有sum(salary)就是所有行相加的结果 。</p><p>有order by 的例子：</p><div class="language-postgresql line-numbers-mode" data-highlighter="prismjs" data-ext="postgresql" data-title="postgresql"><pre><code><span class="line">SELECT salary, sum(salary) OVER (ORDER BY salary) FROM empsalary;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>查询结果：</p><table><thead><tr><th>salary</th><th>sum</th></tr></thead><tbody><tr><td>3500</td><td>3500</td></tr><tr><td>3900</td><td>7400</td></tr><tr><td>4200</td><td>11600</td></tr><tr><td>4500</td><td>16100</td></tr><tr><td>4800</td><td>25700</td></tr><tr><td>4800</td><td>25700</td></tr><tr><td>5000</td><td>30700</td></tr><tr><td>5200</td><td>41100</td></tr><tr><td>5200</td><td>41100</td></tr><tr><td>6000</td><td>47100</td></tr></tbody></table><blockquote><p>注意看4800两条纪录的的sum的值</p></blockquote><p>Window functions are permitted only in the SELECT list and the ORDER BY clause of the query.</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1308811723@qq.com">RuanCong</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-BqkxZZE-.js" defer></script>
  </body>
</html>
